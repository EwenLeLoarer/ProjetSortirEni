{% extends 'base.html.twig' %}

{% block title %}{% endblock %}

{% block body %}
<div class="new_event">
<h1>Créer une sortie</h1>
    {{ form_start(form) }}
    {{ form_row(form.nom) }}
    {{ form_row(form.dateHeureDebut) }}
    {{ form_row(form.dateLimiteInscription) }}
    {{ form_row(form.nbInscriptionsMax) }}
    {{ form_row(form.duree) }}
    {{ form_row(form.infosSortie) }}
    {{ form_row(form.site) }}
    <div style="display: flex; align-items: center;">
        {{ form_row(form.lieu) }}
        <a href="{{ path('app_lieu', { backToSortie: true }) }}" class="btn btn-secondary" style="margin-left: 10px;">
            + Créer un nouveau lieu
        </a>
    </div>
    {{ form_row(form.rue) }}
    {{ form_row(form.codePostal) }}
    {{ form_row(form.ville) }}
    {{ form_row(form.latitude) }}
    {{ form_row(form.longitude) }}
    {{ form_row(form.enregistrer) }}
    {{ form_end(form, {'render_rest': false}) }}
</div>
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const lieuSelect = document.getElementById('sortie_lieu');
            if (!lieuSelect) return;

            function updateLieuDetails(lieuId) {
                if (!lieuId) return;

                fetch('/lieu/' + lieuId)
                    .then(res => res.json())
                    .then(data => {
                        document.getElementById('sortie_rue').value = data.rue;
                        document.getElementById('sortie_codePostal').value = data.codePostal;
                        document.getElementById('sortie_ville').value = data.ville;
                        document.getElementById('sortie_latitude').value = data.latitude;
                        document.getElementById('sortie_longitude').value = data.longitude;
                    });
            }

            lieuSelect.addEventListener('change', function () {
                updateLieuDetails(this.value);
            });

            if (lieuSelect.value) {
                updateLieuDetails(lieuSelect.value);
            }
        });
    </script>
{% endblock %}
