{% extends 'base.html.twig' %}

{% block body %}

    <div class="main_container main_container_index">
        {% if app.user %}
            <div class="name_and_date">
                <p>Date du jour: {{ "now" | date("d/m/Y ") }}</p>
                <p>Participant: {{ app.user.pseudo }}</p>
            </div>
        {% endif %}
        <form method="get" id="filters" data-ajax-list
              data-target="#sorties_list"
              data-delay="200">
            <h2 class="filtre_title">Filtrer les sorties</h2>
            <div class="main_filters">
                <div class="form_filters">
                    <label class="filtre_label">
                        Site:
                        <select name="site" onchange="this.form.submit()">
                            <option value="">Tous les sites</option>
                            {% for site in sites %}
                                <option value="{{ site.id }}" {{ filters.site == site.id ? 'selected' : '' }}>
                                    {{ site.nom }}
                                </option>
                            {% endfor %}
                        </select>
                    </label>

                    <label class="filtre_label">
                        Filtrer:
                        <input type="text" name="query" data-autosubmit="350" placeholder="search">
                    </label>
                </div>
                <div class="form_filters">
                    <label class="filtre_label">
                        Entre:
                        <input type="date" name="from" value="{{ filters.from }}" onchange="this.form.submit()">
                    </label>

                    <label class="filtre_label">
                        Et:
                        <input type="date" name="to" value="{{ filters.to }}" onchange="this.form.submit()">
                    </label>
                </div>
            </div>

            <div class="form_filters">
                {% if app.user %}
                    <fieldset>

                        <label class="filtre_label_right">
                            <input type="checkbox" name="passees" onchange="this.form.submit()" value="1" {{ filters.passees ? 'checked' : '' }}>
                            Sorties passées
                        </label>
                    </fieldset>

                    <fieldset>
                        <label class="filtre_label_right">
                            <input type="checkbox" name="organisees" onchange="this.form.submit()" value="1" {{ filters.organisees ? 'checked' : '' }}>
                            Sorties que j'organise
                        </label>

                        <label class="filtre_label_right">
                            <input type="radio" name="prevues" onchange="this.form.submit()" value="1" {% if filters.prevues is defined and filters.prevues =='1' %}checked{% endif %}>
                            Sorties auxquelles je participe
                        </label>

                        <label class="filtre_label_right">
                            <input type="radio" name="prevues" onchange="this.form.submit()" value="0" {% if filters.prevues is defined and filters.prevues == '0' %}checked{% endif %}>
                            Sorties auxquelles je ne participe pas
                        </label>

                        <label class="filtre_label_right">
                            <input type="radio" name="prevues" onchange="this.form.submit()" value="" {% if filters.prevues is not defined or filters.prevues is same as('') %}checked{% endif %}>
                            Toutes les sorties
                        </label>
                    </fieldset>
                {% else %}
                    <label class="filtre_label_right">
                        <input type="checkbox" name="passees" onchange="this.form.submit()" value="1" {{ filters.passees ? 'checked' : '' }}>
                        Sorties passées
                    </label>
                {% endif %}
            </div>

            <div class="form_buttons">
                <a href="/">Réinitialiser</a>
                {% if app.user %}<a class="button_create" href="{{  path('app_sortie') }}">Créer une sortie</a>{% endif %}
            </div>
        </form>
        <div class="table_area desktop_table" id="sorties_list">
            {% include 'sortie/_table.html.twig' %}
        </div>
        <div class="all_events_tiles mobile_tiles">
            {% for sortie in sorties %}
                <div class="event_tile">
                    <h2>{{ sortie.nom }}</h2>
                    <div class="event_content">
                        <div><img src="{{asset('icons/date.svg')}}" alt="date"> Date de la sortie : <span>  {{ sortie.dateHeureDebut | date('d/m/Y H:i') }}</span></div>
                        <div><img src="{{asset('icons/cloture.svg')}}" alt="cloture"> Clôture : <span>{{ sortie.dateLimiteInscription | date('d/m/Y') }}</span></div>
                        <div>
                                <img src="{{ asset('icons/inscrits.svg') }}" alt="image">
                            Inscrits/places : <span>{{ sortie.nbParticipants }}/{{ sortie.nbInscriptionsMax }}</span></div>
                        <div><img src="{{ asset('icons/etat.svg') }}" alt="image">Etat : <span>{{ sortie.etat.libelle }}</span></div>
                        <div><img src="{{ asset('icons/participant.svg') }}" alt="image">Inscrit : <span>{% if app.user and sortie.isInscrit(app.user) %}
                                    Oui
                                {% else %}
                                    Non
                                {% endif %}</span>
                        </div>
                        <div><img src="{{ asset('icons/utilisateur.svg') }}" alt="image"> Organisateur :&nbsp;
                            <a href="{{ path('app_utilisateur', {id: sortie.organisateur.id}) }}">
                                <span>{{ sortie.organisateur.prenomEtInitiale }}</span>
                            </a>
                        </div>
                    </div>
                    {% if app.user %}
                        <td>
                            {%  include '_partials/actions.html.twig' %}
                        </td>
                    {% endif %}
                </div>
            {% endfor %}
        </div>
    </div>

{% endblock %}
